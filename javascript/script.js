/**
 * Front-end JavaScript
 *
 * The JavaScript code you place here will be processed by esbuild. The output
 * file will be created at `../theme/js/script.min.js` and enqueued in
 * `../theme/functions.php`.
 *
 * For esbuild documentation, please see:
 * https://esbuild.github.io/
 */
import Swiper from 'swiper';

document.addEventListener('DOMContentLoaded', () => {
	initDropdowns();
	initMobileSwipers();
	initMobileSwipersHorizontal();
	initCartUpdate();
});

function initCartUpdate() {
	const DELAY = 400;
	const cartForm = document.querySelector('form.woocommerce-cart-form');
	const updateBtn = document.querySelector('button[name="update_cart"]');

	if (!cartForm || !updateBtn) return;

	let timeout;

	cartForm.addEventListener('change', (e) => {
		if (e.target.matches('input.qty')) {
			if (timeout !== undefined) {
				clearTimeout(timeout);
			}
			timeout = setTimeout(() => {
				updateBtn.click();
			}, DELAY);
		}
	});
}

function initDropdowns() {
	const dropdowns = document.querySelectorAll('[data-js="dropdown"]');
	if (dropdowns.length) {
		dropdowns.forEach((dropdown) => {
			const toggler = dropdown.querySelector(
				'[data-js="dropdown-toggle"]'
			);
			const container = dropdown.querySelector(
				'[data-js="dropdown-container"]'
			);
			if (!toggler || !container) return;

			let dropdownExpanded =
				toggler.getAttribute('aria-expanded') === 'true' || false;
			if (dropdownExpanded) toggleDropdown(true, toggler, container);

			toggler.addEventListener('click', function () {
				toggleDropdown(!dropdownExpanded, toggler, container);
				dropdownExpanded = !dropdownExpanded;
			});

			window.addEventListener('resize', () => {
				toggleDropdown(dropdownExpanded, toggler, container);
			});
		});
	}
}

function toggleDropdown(expanded, btn, container) {
	btn.setAttribute('aria-expanded', expanded);
	if (expanded) {
		container.style.height = container.scrollHeight + 'px';
	} else {
		container.style.removeProperty('height');
	}
}

function toggleMenuContainer() {
	if (-1 !== container.className.indexOf('toggled')) {
		container.className = container.className.replace(' toggled', '');
		button.setAttribute('aria-expanded', 'false');
		button.classList.remove('ks-menu-toggler--active');
	} else {
		container.className += ' toggled';
		button.setAttribute('aria-expanded', 'true');
		button.classList.add('ks-menu-toggler--active');
	}
}
const container = document.getElementById('site-navigation');
const button = document.getElementsByTagName('button')[0];
button.addEventListener('click', () => {
	toggleMenuContainer();
});

// ------------------------------------------------------------------------------

// Swiper

function initMobileSwipers() {
	const swiperContainers = document.querySelectorAll(
		'[data-js="swiper-tiles-mobile"]'
	);
	swiperContainers.forEach((el) => {
		new Swiper(el, {
			spaceBetween: 20,
			slidesPerView: 1.2,
			enabled: true,
			breakpoints: {
				560: {
					slidesPerView: 1.5,
					spaceBetween: 20,
					enabled: true,
				},
				768: {
					slidesPerView: 2.2,
					spaceBetween: 25,
					enabled: true,
				},
				1000: {
					slidesPerView: 2.5,
					spaceBetween: 35,
					enabled: true,
				},
				1280: {
					slidesPerView: 'auto',
					spaceBetween: 0,
					enabled: false,
				},
			},
		});
	});
}

function initMobileSwipersHorizontal() {
	console.log('test2');
	const swiperContainers2 = document.querySelectorAll(
		'[data-js="swiper-tiles-mobile-horizontal"]'
	);
	swiperContainers2.forEach((el) => {
		new Swiper(el, {
			spaceBetween: 20,
			slidesPerView: 1.2,
			enabled: true,
			breakpoints: {
				560: {
					slidesPerView: 1.2,
					spaceBetween: 20,
					enabled: true,
				},
				1280: {
					slidesPerView: 1.7,
					spaceBetween: 20,
					enabled: true,
				},
			},
		});
	});
}
